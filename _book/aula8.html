<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Class 8 20 10 2020 - t-test and ANOVA are just linear models | Notes for Ecological Modelling</title>
  <meta name="description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Class 8 20 10 2020 - t-test and ANOVA are just linear models | Notes for Ecological Modelling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Class 8 20 10 2020 - t-test and ANOVA are just linear models | Notes for Ecological Modelling" />
  
  <meta name="twitter:description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Tiago A. Marques" />


<meta name="date" content="2020-11-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="aula7.html"/>
<link rel="next" href="aula9.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="about-regression.html"><a href="about-regression.html"><i class="fa fa-check"></i><b>2</b> About regression</a><ul>
<li class="chapter" data-level="2.1" data-path="about-regression.html"><a href="about-regression.html#what-is-a-regression"><i class="fa fa-check"></i><b>2.1</b> What is a regression?</a></li>
<li class="chapter" data-level="2.2" data-path="about-regression.html"><a href="about-regression.html#the-general-linear-model"><i class="fa fa-check"></i><b>2.2</b> The general linear model</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="handson.html"><a href="handson.html"><i class="fa fa-check"></i><b>3</b> Hands On Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="handson.html"><a href="handson.html#the-assumptions-are-on-the-residuals-not-the-data"><i class="fa fa-check"></i><b>3.1</b> The assumptions are on the residuals, not the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="aula6.html"><a href="aula6.html"><i class="fa fa-check"></i><b>4</b> Class 6 13 10 2020</a><ul>
<li class="chapter" data-level="4.1" data-path="aula6.html"><a href="aula6.html#implementing-a-regression"><i class="fa fa-check"></i><b>4.1</b> Implementing a regression</a></li>
<li class="chapter" data-level="4.2" data-path="aula6.html"><a href="aula6.html#simulating-regression-data"><i class="fa fa-check"></i><b>4.2</b> Simulating regression data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="aula6.html"><a href="aula6.html#what-is-the-effect-of-increasing-the-error-a-simulation-experiment"><i class="fa fa-check"></i><b>4.2.1</b> What is the effect of increasing the error: a simulation experiment</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="aula7.html"><a href="aula7.html"><i class="fa fa-check"></i><b>5</b> Class 7 14 10 2020</a><ul>
<li class="chapter" data-level="5.1" data-path="aula7.html"><a href="aula7.html#task-1"><i class="fa fa-check"></i><b>5.1</b> Task 1</a></li>
<li class="chapter" data-level="5.2" data-path="aula7.html"><a href="aula7.html#task-2"><i class="fa fa-check"></i><b>5.2</b> Task 2</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="aula8.html"><a href="aula8.html"><i class="fa fa-check"></i><b>6</b> Class 8 20 10 2020 - t-test and ANOVA are just linear models</a><ul>
<li class="chapter" data-level="6.1" data-path="aula8.html"><a href="aula8.html#the-t-test"><i class="fa fa-check"></i><b>6.1</b> The t-test</a></li>
<li class="chapter" data-level="6.2" data-path="aula8.html"><a href="aula8.html#anova"><i class="fa fa-check"></i><b>6.2</b> ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="aula9.html"><a href="aula9.html"><i class="fa fa-check"></i><b>7</b> Class 9: 21 10 2020 - ANCOVA is (also) just a linear model</a><ul>
<li class="chapter" data-level="7.1" data-path="aula9.html"><a href="aula9.html#common-slope-different-intercepts-per-treatment"><i class="fa fa-check"></i><b>7.1</b> Common slope, different intercepts per treatment</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="aula10.html"><a href="aula10.html"><i class="fa fa-check"></i><b>8</b> Class 10: 27 10 2020</a><ul>
<li class="chapter" data-level="8.1" data-path="aula10.html"><a href="aula10.html#same-story-another-spin"><i class="fa fa-check"></i><b>8.1</b> Same story, another spin</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="aula11.html"><a href="aula11.html"><i class="fa fa-check"></i><b>9</b> Class 11: 03 11 2020 ANCOVA with different slopes: interactions</a><ul>
<li class="chapter" data-level="9.1" data-path="aula11.html"><a href="aula11.html#about-interactions"><i class="fa fa-check"></i><b>9.1</b> About interactions</a></li>
<li class="chapter" data-level="9.2" data-path="aula11.html"><a href="aula11.html#task-1-implementing-the-ancova-with-different-slopes"><i class="fa fa-check"></i><b>9.2</b> Task 1 Implementing the ANCOVA with different slopes</a></li>
<li class="chapter" data-level="9.3" data-path="aula11.html"><a href="aula11.html#task-2-modeling-a-data-set"><i class="fa fa-check"></i><b>9.3</b> Task 2 Modeling a data set</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aula13.html"><a href="aula13.html"><i class="fa fa-check"></i><b>10</b> Class 12: 04 11 2020 Interactions between continous covariates</a></li>
<li class="chapter" data-level="11" data-path="conlusion-on-linear-regression.html"><a href="conlusion-on-linear-regression.html"><i class="fa fa-check"></i><b>11</b> Conlusion on linear regression</a><ul>
<li class="chapter" data-level="11.1" data-path="conlusion-on-linear-regression.html"><a href="conlusion-on-linear-regression.html#conclusion"><i class="fa fa-check"></i><b>11.1</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="aula12.html"><a href="aula12.html"><i class="fa fa-check"></i><b>12</b> Class 12: 04 11 2020 Maximum likelihood and all that</a></li>
<li class="chapter" data-level="13" data-path="aula13a.html"><a href="aula13a.html"><i class="fa fa-check"></i><b>13</b> Class 13a: 4 11 2020 Maximum likelihood and all that</a></li>
<li class="chapter" data-level="14" data-path="aula14.html"><a href="aula14.html"><i class="fa fa-check"></i><b>14</b> Class 14: 10 10 2020</a></li>
<li class="chapter" data-level="15" data-path="aula15.html"><a href="aula15.html"><i class="fa fa-check"></i><b>15</b> Class 15: 11 11 2020</a></li>
<li class="chapter" data-level="16" data-path="aula16.html"><a href="aula16.html"><i class="fa fa-check"></i><b>16</b> Class 16: 17 11 2020</a></li>
<li class="chapter" data-level="17" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>17</b> Final Words</a></li>
<li class="chapter" data-level="18" data-path="aknowledgments.html"><a href="aknowledgments.html"><i class="fa fa-check"></i><b>18</b> Aknowledgments</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for Ecological Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aula8" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Class 8 20 10 2020 - t-test and ANOVA are just linear models</h1>
<p>The objective of this chapter is to explore different regression models and to see how they relate to statistical procedures one might not associate with a regression, when in fact, they are just special cases of a regression.</p>
<div id="the-t-test" class="section level2">
<h2><span class="header-section-number">6.1</span> The t-test</h2>
<p>While we did not do the t-test in class, this is useful because it allows you to see how a simple t-test is just a linear model too, and acts as a building block for the next examples. The t-test allows us to test the null hypothesis that two samples have the same mean.</p>
<p>Create some data</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1"><span class="co">#Making up a t-test</span></a>
<a class="sourceLine" id="cb103-2" title="2"><span class="co">#making sure everyone gets the same results</span></a>
<a class="sourceLine" id="cb103-3" title="3"><span class="kw">set.seed</span>(<span class="dv">980</span>)</a></code></pre></div>
<p>Then we define the sample size and the number of treatments</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="co">#define sample size</span></a>
<a class="sourceLine" id="cb104-2" title="2">n=<span class="dv">100</span></a>
<a class="sourceLine" id="cb104-3" title="3"><span class="co">#define treatments</span></a>
<a class="sourceLine" id="cb104-4" title="4">tr=<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb104-5" title="5"><span class="co">#how many treatments - 2 for a t test</span></a>
<a class="sourceLine" id="cb104-6" title="6">ntr=<span class="kw">length</span>(tr)</a>
<a class="sourceLine" id="cb104-7" title="7"><span class="co">#balanced design</span></a>
<a class="sourceLine" id="cb104-8" title="8">n.by.tr=n<span class="op">/</span>ntr</a></code></pre></div>
<p>Now, we can simulate some data. First, the treatments</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1">type=<span class="kw">as.factor</span>(<span class="kw">rep</span>(tr,<span class="dt">each=</span>n.by.tr))</a>
<a class="sourceLine" id="cb105-2" title="2">cores=<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>ntr,<span class="dt">each=</span>n.by.tr)</a></code></pre></div>
<p>Then we define the means by treatment - note that they are different, so the null hypothesis in the t-test, that the mean of a is equal to the mean of b, is known to be false in this case.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="co">#define 4 means</span></a>
<a class="sourceLine" id="cb106-2" title="2">ms=<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)</a></code></pre></div>
<p>Then, the key part, the response variable, with a different mean by treatment. Note the use of the <code>ifelse</code> function, which evaluates its first argument and then assigns the value of its second argument if the first is true or the value of the second if its first argument is false. An example</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="dv">77</span>)</a></code></pre></div>
<pre><code>## [1] 77</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&lt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="dv">77</span>)</a></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p>So now, generate the response data</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1">ys=<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;a&quot;</span>,ms[<span class="dv">1</span>],ms[<span class="dv">2</span>])<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">1.5</span>)</a></code></pre></div>
<p>Look at the data</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1"><span class="kw">plot</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Now, we can run the usual t-test</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="kw">t.test</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  ys by type
## t = -2.8043, df = 97.475, p-value = 0.006087
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.4263293 -0.2441277
## sample estimates:
## mean in group a mean in group b 
##        3.106656        3.941884</code></pre>
<p>and now we can do it the linear regression way</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1">lm0=<span class="kw">lm</span>(ys<span class="op">~</span>type)</a>
<a class="sourceLine" id="cb115-2" title="2"><span class="kw">summary</span>(lm0)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ys ~ type)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.1489 -0.9131 -0.1315  1.0295  3.2450 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.1067     0.2106  14.751  &lt; 2e-16 ***
## typeb         0.8352     0.2978   2.804  0.00608 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.489 on 98 degrees of freedom
## Multiple R-squared:  0.07428,	Adjusted R-squared:  0.06484 
## F-statistic: 7.864 on 1 and 98 DF,  p-value: 0.006081</code></pre>
<p>and as you can see, we get the same result for the test statistic. It is the same thing! And we can naturally get the estimated means per group. The mean for a is just the intercept of the model. To get the mean of the group b we add the mean of group b to the intercept, as</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1"><span class="co">#mean of ys under treatment a</span></a>
<a class="sourceLine" id="cb117-2" title="2"><span class="kw">summary</span>(lm0)<span class="op">$</span>coefficients[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 3.106656</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="co">#mean of ys under treatment b</span></a>
<a class="sourceLine" id="cb119-2" title="2"><span class="kw">summary</span>(lm0)<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm0<span class="op">$</span>coefficients[<span class="dv">2</span>]</a></code></pre></div>
<pre><code>##    typeb 
## 3.941884</code></pre>
<p>This is required because in a linear model, all the other parameters associated with levels of a factor will be compared to a reference value, that of the intercept, which happens to be the mean under treatment a. Below you will see more examples of this.</p>
<p>Note we were able to detect the null was false, but this was because we had a decent sample size compared to the variance of the measurements and the magnitude of the true effect (the difference of the means). If we keep the sample size constant but we increase the noise or decrease the magnitude of the difference, we might not get the same result, and make a type II error!</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="co">#define 2 means</span></a>
<a class="sourceLine" id="cb121-2" title="2">ms=<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb121-3" title="3"><span class="co">#increase the variance of the process</span></a>
<a class="sourceLine" id="cb121-4" title="4">ys=<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;a&quot;</span>,ms[<span class="dv">1</span>],ms[<span class="dv">2</span>])<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">5</span>)</a></code></pre></div>
<p>Look at the data, we can see much more variation</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">plot</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Now, we can run the usual t-test</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="kw">t.test</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  ys by type
## t = -1.3609, df = 97.949, p-value = 0.1767
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -3.2822693  0.6118174
## sample estimates:
## mean in group a mean in group b 
##        2.024963        3.360189</code></pre>
<p>and now we can do it the linear regression way</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">lm0=<span class="kw">lm</span>(ys<span class="op">~</span>type)</a>
<a class="sourceLine" id="cb125-2" title="2"><span class="kw">summary</span>(lm0)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ys ~ type)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -12.1746  -3.2719   0.2527   3.0578  12.0085 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   2.0250     0.6938   2.919  0.00436 **
## typeb         1.3352     0.9811   1.361  0.17667   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.906 on 98 degrees of freedom
## Multiple R-squared:  0.01855,	Adjusted R-squared:  0.008533 
## F-statistic: 1.852 on 1 and 98 DF,  p-value: 0.1767</code></pre>
<p>and as you can see, we get the same result for the test statistic, but now with a non significant test.</p>
<p>The same would have happened if we decreased the true difference, while keeping the original magnitude of the error</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="co">#define 2 means</span></a>
<a class="sourceLine" id="cb127-2" title="2">ms=<span class="kw">c</span>(<span class="dv">3</span>,<span class="fl">3.1</span>)</a>
<a class="sourceLine" id="cb127-3" title="3"><span class="co">#increase the variance of the process</span></a>
<a class="sourceLine" id="cb127-4" title="4">ys=<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;a&quot;</span>,ms[<span class="dv">1</span>],ms[<span class="dv">2</span>])<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">1.5</span>)</a></code></pre></div>
<p>Look at the data, we can see again lower variation, but the difference across treatments is very small (so, hard to detect!)</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="kw">plot</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Now, we can run the usual t-test</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1"><span class="kw">t.test</span>(ys<span class="op">~</span>type)</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  ys by type
## t = -0.7994, df = 97.455, p-value = 0.426
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.8149517  0.3469402
## sample estimates:
## mean in group a mean in group b 
##        3.158868        3.392874</code></pre>
<p>and now we can do it the linear regression way</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1">lm0=<span class="kw">lm</span>(ys<span class="op">~</span>type)</a>
<a class="sourceLine" id="cb131-2" title="2"><span class="kw">summary</span>(lm0)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ys ~ type)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.7661 -0.9318  0.0812  0.9087  3.5981 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.1589     0.2070  15.261   &lt;2e-16 ***
## typeb         0.2340     0.2927   0.799    0.426    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.464 on 98 degrees of freedom
## Multiple R-squared:  0.006479,	Adjusted R-squared:  -0.003659 
## F-statistic: 0.639 on 1 and 98 DF,  p-value: 0.426</code></pre>
</div>
<div id="anova" class="section level2">
<h2><span class="header-section-number">6.2</span> ANOVA</h2>
<p>We move on with perhaps the most famous example of a statistical test/procedure, the ANOVA. An ANOVA is nothing but a linear model, where we have a continuous response variable, which we want to explain as a function of a factor (with several levels, or treatments).</p>
<p>We simulate a data set, beginning by making sure everyone gets the same results by using <code>set.seed</code></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1"><span class="co">#Making up an ANOVA</span></a>
<a class="sourceLine" id="cb133-2" title="2"><span class="co">#An ANOVA</span></a>
<a class="sourceLine" id="cb133-3" title="3"><span class="co">#making sure everyone gets the same results</span></a>
<a class="sourceLine" id="cb133-4" title="4"><span class="kw">set.seed</span>(<span class="dv">12345</span>)</a></code></pre></div>
<p>Then we define the sample size and the number of treatments</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co">#define sample size</span></a>
<a class="sourceLine" id="cb134-2" title="2">n=<span class="dv">2000</span></a>
<a class="sourceLine" id="cb134-3" title="3"><span class="co">#define treatments</span></a>
<a class="sourceLine" id="cb134-4" title="4">tr=<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>,<span class="st">&quot;c&quot;</span>,<span class="st">&quot;d&quot;</span>)</a>
<a class="sourceLine" id="cb134-5" title="5"><span class="co">#how many treatments</span></a>
<a class="sourceLine" id="cb134-6" title="6">ntr=<span class="kw">length</span>(tr)</a>
<a class="sourceLine" id="cb134-7" title="7"><span class="co">#balanced design</span></a>
<a class="sourceLine" id="cb134-8" title="8">n.by.tr=n<span class="op">/</span>ntr</a></code></pre></div>
<p>now, we can simulate some data. First, the treatments, but we also generate a independent variable that is not really used for now (<code>xs</code>).</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1"><span class="co">#generate data</span></a>
<a class="sourceLine" id="cb135-2" title="2">xs=<span class="kw">runif</span>(n,<span class="dv">10</span>,<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb135-3" title="3">type=<span class="kw">as.factor</span>(<span class="kw">rep</span>(tr,<span class="dt">each=</span>n.by.tr))</a>
<a class="sourceLine" id="cb135-4" title="4"><span class="co">#if I wanted to recode the levels such that c was the baseline</span></a>
<a class="sourceLine" id="cb135-5" title="5"><span class="co">#type=factor(type,levels = c(&quot;c&quot;,&quot;a&quot;,&quot;b&quot;,&quot;d&quot;))</span></a>
<a class="sourceLine" id="cb135-6" title="6"><span class="co">#get colors for plotting</span></a>
<a class="sourceLine" id="cb135-7" title="7">cores=<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>ntr,<span class="dt">each=</span>n.by.tr)</a></code></pre></div>
<p>Then we define the means by treatment - note that they are different, so the null hypothesis in an ANOVA, that all the means are the same, is false.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="co">#define 4 means</span></a>
<a class="sourceLine" id="cb136-2" title="2">ms=<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">2</span>)</a></code></pre></div>
<p>Then, the key part, the response variable, with a different mean by treatment. Note the use of the <code>ifelse</code> function, which evaluates its first argument and then assigns the value of its second argument if the first is true or the value of the second if its first argument is false. An example</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="dv">77</span>)</a></code></pre></div>
<pre><code>## [1] 77</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&lt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="dv">77</span>)</a></code></pre></div>
<pre><code>## [1] 55</code></pre>
<p>Note these can be used nested, leading to possible multiple outcomes, and I use that below to define 4 different means depending on the treatment of the observation</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&lt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">2</span>,<span class="dv">55</span>,<span class="dv">68</span>))</a></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">2</span>,<span class="dv">666</span>,<span class="dv">68</span>))</a></code></pre></div>
<pre><code>## [1] 666</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1"><span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&gt;</span><span class="dv">4</span>,<span class="dv">55</span>,<span class="kw">ifelse</span>(<span class="dv">3</span><span class="op">&lt;</span><span class="dv">2</span>,<span class="dv">666</span>,<span class="dv">68</span>))</a></code></pre></div>
<pre><code>## [1] 68</code></pre>
<p>So now, generate the data</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1"><span class="co">#ys, not a function of the xs!!!</span></a>
<a class="sourceLine" id="cb147-2" title="2">ys=<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;a&quot;</span>,ms[<span class="dv">1</span>],<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;b&quot;</span>,ms[<span class="dv">2</span>],<span class="kw">ifelse</span>(type<span class="op">==</span><span class="st">&quot;c&quot;</span>,ms[<span class="dv">3</span>],ms[<span class="dv">4</span>])))<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">3</span>)</a></code></pre></div>
<p>We can actually look at the simulated data</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb148-2" title="2"><span class="kw">plot</span>(ys<span class="op">~</span>type,<span class="dt">col=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1"><span class="co">#abline(h=ms,col=1:4)</span></a></code></pre></div>
<p>finally, we can implement the linear model and look at its summary</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1">lm.anova=<span class="kw">lm</span>(ys<span class="op">~</span>type)</a>
<a class="sourceLine" id="cb150-2" title="2"><span class="kw">summary</span>(lm.anova)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ys ~ type)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -9.8735 -2.0115  0.0301  2.0208  9.9976 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   2.8694     0.1319  21.753  &lt; 2e-16 ***
## typeb         2.0788     0.1865  11.143  &lt; 2e-16 ***
## typec         2.9806     0.1865  15.978  &lt; 2e-16 ***
## typed        -0.8726     0.1865  -4.678 3.09e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.95 on 1996 degrees of freedom
## Multiple R-squared:  0.2163,	Adjusted R-squared:  0.2151 
## F-statistic: 183.6 on 3 and 1996 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>note that, again, we can manipulate any sub-components of the created objects</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1"><span class="co">#see the parameters</span></a>
<a class="sourceLine" id="cb152-2" title="2">lm.anova<span class="op">$</span>coefficients</a></code></pre></div>
<pre><code>## (Intercept)       typeb       typec       typed 
##   2.8694412   2.0787628   2.9806367  -0.8726428</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="co">#see the third parameter</span></a>
<a class="sourceLine" id="cb154-2" title="2">lm.anova<span class="op">$</span>coefficients[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>##    typec 
## 2.980637</code></pre>
<p>Not surprisingly, because the means were different and we had a large sample size, everything is highly significant. Note that the ANOVA test is actually presented in the regression output, and that is the corresponding F-test</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1"><span class="kw">summary</span>(lm.anova)<span class="op">$</span>fstatistic</a></code></pre></div>
<pre><code>##     value     numdf     dendf 
##  183.6156    3.0000 1996.0000</code></pre>
<p>and we can use the F distribution to calculate the corresponding P-value (note that is already in the output above)</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1">ftest=<span class="kw">summary</span>(lm.anova)<span class="op">$</span>fstatistic[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb158-2" title="2">df1=<span class="kw">summary</span>(lm.anova)<span class="op">$</span>fstatistic[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb158-3" title="3">df2=<span class="kw">summary</span>(lm.anova)<span class="op">$</span>fstatistic[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb158-4" title="4"><span class="kw">pt</span>(ftest,df1,df2)</a></code></pre></div>
<pre><code>##         value 
## 1.402786e-131</code></pre>
<p>OK, this is actually the exact value, while above the value was reported as just a small value (&lt; 2.2 <span class="math inline">\(\times\)</span> 10<span class="math inline">\(^{-16}\)</span>), but it is the same value, believe me!</p>
<p>Finally, to show (by example) this is just what the ANOVA does, we have the NAOVA itself</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="kw">summary</span>(<span class="kw">aov</span>(lm.anova))</a></code></pre></div>
<pre><code>##               Df Sum Sq Mean Sq F value Pr(&gt;F)    
## type           3   4792  1597.5   183.6 &lt;2e-16 ***
## Residuals   1996  17365     8.7                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>where everything is the same (test statistic, degrees of freedom and p-values).</p>
<p>Conclusion: an ANOVA is just a special case of a linear model, one where we have a continuous response variable and a factor explanatory covariate. In fact, a two way ANOVA is just the extension where we have a continuous response variable and 2 factor explanatory covariates, and, you guessed it, a three way ANOVA means we have a continuous response variable and a 3 factor explanatory covariates.</p>
<p>Just to finish up this example, we could now plot the true means per treatment, the estimated means per treatment</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb162-2" title="2"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(type),ys,<span class="dt">col=</span><span class="kw">as.numeric</span>(type),<span class="dt">xlab=</span><span class="st">&quot;Treatment&quot;</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb162-3" title="3"><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb162-4" title="4"><span class="co">#plot the estimated line for type a</span></a>
<a class="sourceLine" id="cb162-5" title="5"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb162-6" title="6"><span class="co">#plot the mean line for type a</span></a>
<a class="sourceLine" id="cb162-7" title="7"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;a&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb162-8" title="8"><span class="co">#plot the real mean for type a</span></a>
<a class="sourceLine" id="cb162-9" title="9"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb162-10" title="10"><span class="co">#and now for the other types</span></a>
<a class="sourceLine" id="cb162-11" title="11"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb162-12" title="12"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;b&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb162-13" title="13"><span class="co">#plot the real mean for type b</span></a>
<a class="sourceLine" id="cb162-14" title="14"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb162-15" title="15"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">3</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb162-16" title="16"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;c&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">3</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb162-17" title="17"><span class="co">#plot the real mean for type c</span></a>
<a class="sourceLine" id="cb162-18" title="18"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">3</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">3</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb162-19" title="19"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">4</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb162-20" title="20"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;d&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb162-21" title="21"><span class="co">#plot the real mean for type a</span></a>
<a class="sourceLine" id="cb162-22" title="22"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">4</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb162-23" title="23"><span class="kw">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="kw">c</span>(<span class="st">&quot;Estimated&quot;</span>,<span class="st">&quot;Mean of data&quot;</span>,<span class="st">&quot;True&quot;</span>),<span class="dt">lwd=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>),<span class="dt">inset=</span><span class="fl">0.03</span>)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>It’s not easy to see because these overlap (large sample size, high precision) but the estimated means are really close to the real means. It’s a bit easier to see if we separate in 4 plots and zoom in on the mean of each treatment, but still the blue lines are all on top of each other, since the mean value was estimated real close to truth (truth=2, estimated = 1.9967984).</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1"><span class="co">#see this in 4 plots, less blur</span></a>
<a class="sourceLine" id="cb163-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb163-3" title="3"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(type),ys,<span class="dt">col=</span><span class="kw">as.numeric</span>(type),<span class="dt">xlab=</span><span class="st">&quot;Treatment&quot;</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">ylim=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;a&quot;</span>])<span class="op">+</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb163-4" title="4"><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb163-5" title="5"><span class="co">#plot the estimated line for type a</span></a>
<a class="sourceLine" id="cb163-6" title="6"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb163-7" title="7"><span class="co">#plot the mean line for type a</span></a>
<a class="sourceLine" id="cb163-8" title="8"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;a&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-9" title="9"><span class="co">#plot the real mean for type a</span></a>
<a class="sourceLine" id="cb163-10" title="10"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">1</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">1</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb163-11" title="11"><span class="co">#and now for the other types</span></a>
<a class="sourceLine" id="cb163-12" title="12"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(type),ys,<span class="dt">col=</span><span class="kw">as.numeric</span>(type),<span class="dt">xlab=</span><span class="st">&quot;Treatment&quot;</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">ylim=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;b&quot;</span>])<span class="op">+</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb163-13" title="13"><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb163-14" title="14"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-15" title="15"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;b&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-16" title="16"><span class="co">#plot the real mean for type b</span></a>
<a class="sourceLine" id="cb163-17" title="17"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">2</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb163-18" title="18"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(type),ys,<span class="dt">col=</span><span class="kw">as.numeric</span>(type),<span class="dt">xlab=</span><span class="st">&quot;Treatment&quot;</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">ylim=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;c&quot;</span>])<span class="op">+</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb163-19" title="19"><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb163-20" title="20"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">3</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb163-21" title="21"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;c&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">3</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-22" title="22"><span class="co">#plot the real mean for type c</span></a>
<a class="sourceLine" id="cb163-23" title="23"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">3</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">3</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb163-24" title="24"><span class="kw">plot</span>(<span class="kw">as.numeric</span>(type),ys,<span class="dt">col=</span><span class="kw">as.numeric</span>(type),<span class="dt">xlab=</span><span class="st">&quot;Treatment&quot;</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">ylim=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;d&quot;</span>])<span class="op">+</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb163-25" title="25"><span class="kw">axis</span>(<span class="dv">1</span>,<span class="dt">at=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,letters[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a>
<a class="sourceLine" id="cb163-26" title="26"><span class="kw">abline</span>(<span class="dt">h=</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">4</span>],<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb163-27" title="27"><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">mean</span>(ys[type<span class="op">==</span><span class="st">&quot;d&quot;</span>]),<span class="dt">lwd=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lty=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb163-28" title="28"><span class="co">#plot the real mean for type a</span></a>
<a class="sourceLine" id="cb163-29" title="29"><span class="kw">abline</span>(<span class="dt">h=</span>ms[<span class="dv">4</span>],<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="dv">4</span>,<span class="dt">lty=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1"><span class="co">#legend(&quot;bottomright&quot;,c(&quot;Estimated&quot;,&quot;Mean of data&quot;,&quot;True&quot;),lwd=c(4,1,2),lty=c(1,3,2),inset=0.05)</span></a></code></pre></div>
<p>Now we can check how we can obtain the estimated means from the actual parameters of the regression model (yes, that is what the regression does, it calculates the expected mean of the response, conditional on the treatment).</p>
<p>This is the estimated mean per treatment, using function <code>tapply</code> (very useful function to get any statistics over a variable, inside groups defined by a second variable, here the treatment)</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" title="1"><span class="kw">tapply</span>(<span class="dt">X=</span>ys,<span class="dt">INDEX=</span>type,<span class="dt">FUN=</span>mean)</a></code></pre></div>
<pre><code>##        a        b        c        d 
## 2.869441 4.948204 5.850078 1.996798</code></pre>
<p>and checking these are obtained from the regression coefficients.
An important note. When you fit models with factors (like here), the intercept term will correspond to the mean of the reference level of the factor(s). Hence, to get the other means, you always have to sum the parameter of the corresponding level to the intercept. So we do it below</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1"><span class="co">#check ANOVA is just computing the mean in each group</span></a>
<a class="sourceLine" id="cb167-2" title="2">lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## (Intercept) 
##    2.869441</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1">lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## (Intercept) 
##    4.948204</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## (Intercept) 
##    5.850078</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1">lm.anova<span class="op">$</span>coefficients[<span class="dv">1</span>]<span class="op">+</span>lm.anova<span class="op">$</span>coefficients[<span class="dv">4</span>]</a></code></pre></div>
<pre><code>## (Intercept) 
##    1.996798</code></pre>
<p>and we can see these are exactly the same values.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="aula7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="aula9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ECOMODbook.pdf", "ECOMODbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
