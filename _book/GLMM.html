<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 20 Random effects and mixed models | Notes for Ecological Modelling</title>
  <meta name="description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 20 Random effects and mixed models | Notes for Ecological Modelling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 20 Random effects and mixed models | Notes for Ecological Modelling" />
  
  <meta name="twitter:description" content="This is based on Yihui Xie’s a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Tiago A. Marques" />


<meta name="date" content="2023-11-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="aula16.html"/>
<link rel="next" href="aula18.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="mainintro.html"><a href="mainintro.html"><i class="fa fa-check"></i><b>2</b> Preamble</a></li>
<li class="chapter" data-level="3" data-path="aknowledgments.html"><a href="aknowledgments.html"><i class="fa fa-check"></i><b>3</b> Aknowledgments</a></li>
<li class="chapter" data-level="4" data-path="usingRintro.html"><a href="usingRintro.html"><i class="fa fa-check"></i><b>4</b> Using R</a></li>
<li class="chapter" data-level="5" data-path="prelim.html"><a href="prelim.html"><i class="fa fa-check"></i><b>5</b> Preliminaries</a>
<ul>
<li class="chapter" data-level="5.1" data-path="prelim.html"><a href="prelim.html#lbtb"><i class="fa fa-check"></i><b>5.1</b> Learning by the book</a></li>
<li class="chapter" data-level="5.2" data-path="prelim.html"><a href="prelim.html#ftpt"><i class="fa fa-check"></i><b>5.2</b> Following the paper trail</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="about-regression.html"><a href="about-regression.html"><i class="fa fa-check"></i><b>6</b> About regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="about-regression.html"><a href="about-regression.html#what-is-a-regression"><i class="fa fa-check"></i><b>6.1</b> What is a regression?</a></li>
<li class="chapter" data-level="6.2" data-path="about-regression.html"><a href="about-regression.html#the-general-linear-model"><i class="fa fa-check"></i><b>6.2</b> The general linear model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="handson.html"><a href="handson.html"><i class="fa fa-check"></i><b>7</b> Hands On Regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="handson.html"><a href="handson.html#the-assumptions-are-on-the-residuals-not-the-data"><i class="fa fa-check"></i><b>7.1</b> The assumptions are on the residuals, not the data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="RIO.html"><a href="RIO.html"><i class="fa fa-check"></i><b>8</b> Regression inside out</a>
<ul>
<li class="chapter" data-level="8.1" data-path="RIO.html"><a href="RIO.html#implementing-a-regression"><i class="fa fa-check"></i><b>8.1</b> Implementing a regression</a></li>
<li class="chapter" data-level="8.2" data-path="RIO.html"><a href="RIO.html#simulating-regression-data"><i class="fa fa-check"></i><b>8.2</b> Simulating regression data</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="RIO.html"><a href="RIO.html#what-is-the-effect-of-increasing-the-error-a-simulation-experiment"><i class="fa fa-check"></i><b>8.2.1</b> What is the effect of increasing the error: a simulation experiment</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="RIO.html"><a href="RIO.html#two-tasks-to-further-understand-regression"><i class="fa fa-check"></i><b>8.3</b> Two tasks to further understand regression</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="RIO.html"><a href="RIO.html#task-1"><i class="fa fa-check"></i><b>8.3.1</b> Task 1</a></li>
<li class="chapter" data-level="8.3.2" data-path="RIO.html"><a href="RIO.html#task-2"><i class="fa fa-check"></i><b>8.3.2</b> Task 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ttestANOVAasLMs.html"><a href="ttestANOVAasLMs.html"><i class="fa fa-check"></i><b>9</b> t-tests and ANOVAs are just linear models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ttestANOVAasLMs.html"><a href="ttestANOVAasLMs.html#a-one-sample-t-test-is-the-simplest-possible-linear-model"><i class="fa fa-check"></i><b>9.1</b> A one sample t-test is the simplest possible linear model</a></li>
<li class="chapter" data-level="9.2" data-path="ttestANOVAasLMs.html"><a href="ttestANOVAasLMs.html#the-t-test"><i class="fa fa-check"></i><b>9.2</b> The t-test</a></li>
<li class="chapter" data-level="9.3" data-path="ttestANOVAasLMs.html"><a href="ttestANOVAasLMs.html#anova"><i class="fa fa-check"></i><b>9.3</b> ANOVA</a></li>
<li class="chapter" data-level="9.4" data-path="ttestANOVAasLMs.html"><a href="ttestANOVAasLMs.html#a-two-way-anova-and-beyhond-ex-task-do-it-yourself"><i class="fa fa-check"></i><b>9.4</b> A two way ANOVA, and beyhond (ex Task: do it yourself!)</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ANCOVAasLM.html"><a href="ANCOVAasLM.html"><i class="fa fa-check"></i><b>10</b> ANCOVA is (also) just a linear model</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ANCOVAasLM.html"><a href="ANCOVAasLM.html#common-slope-different-intercepts-per-treatment"><i class="fa fa-check"></i><b>10.1</b> Common slope, different intercepts per treatment</a></li>
<li class="chapter" data-level="10.2" data-path="ANCOVAasLM.html"><a href="ANCOVAasLM.html#ANCOVAe"><i class="fa fa-check"></i><b>10.2</b> ANCOVA encore</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="ANCOVAasLM.html"><a href="ANCOVAasLM.html#same-story-another-spin"><i class="fa fa-check"></i><b>10.2.1</b> Same story, another spin</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ANCOVAdifslopes.html"><a href="ANCOVAdifslopes.html"><i class="fa fa-check"></i><b>11</b> ANCOVA with different slopes: interactions</a>
<ul>
<li class="chapter" data-level="11.1" data-path="ANCOVAdifslopes.html"><a href="ANCOVAdifslopes.html#about-interactions"><i class="fa fa-check"></i><b>11.1</b> About interactions</a></li>
<li class="chapter" data-level="11.2" data-path="ANCOVAdifslopes.html"><a href="ANCOVAdifslopes.html#task-1-implementing-the-ancova-with-different-slopes"><i class="fa fa-check"></i><b>11.2</b> Task 1 Implementing the ANCOVA with different slopes</a></li>
<li class="chapter" data-level="11.3" data-path="ANCOVAdifslopes.html"><a href="ANCOVAdifslopes.html#task-2-modeling-a-data-set"><i class="fa fa-check"></i><b>11.3</b> Task 2 Modeling a data set</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ContinousInteractions.html"><a href="ContinousInteractions.html"><i class="fa fa-check"></i><b>12</b> Interactions between continous covariates</a>
<ul>
<li class="chapter" data-level="12.1" data-path="ContinousInteractions.html"><a href="ContinousInteractions.html#larger-order-interactions"><i class="fa fa-check"></i><b>12.1</b> Larger order interactions</a></li>
<li class="chapter" data-level="12.2" data-path="ContinousInteractions.html"><a href="ContinousInteractions.html#conclusion-on-linear-regression"><i class="fa fa-check"></i><b>12.2</b> Conclusion on linear regression</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="ContinousInteractions.html"><a href="ContinousInteractions.html#conclusion"><i class="fa fa-check"></i><b>12.2.1</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="LMinPractice.html"><a href="LMinPractice.html"><i class="fa fa-check"></i><b>13</b> Real life examples using linear models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="LMinPractice.html"><a href="LMinPractice.html#rikz-data"><i class="fa fa-check"></i><b>13.1</b> RIKZ data</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="MLEs.html"><a href="MLEs.html"><i class="fa fa-check"></i><b>14</b> Class 13: 10 11 2020 Maximum likelihood and all that</a>
<ul>
<li class="chapter" data-level="14.1" data-path="MLEs.html"><a href="MLEs.html#maximizing-a-likelihood-algebraically"><i class="fa fa-check"></i><b>14.1</b> Maximizing a likelihood algebraically</a></li>
<li class="chapter" data-level="14.2" data-path="MLEs.html"><a href="MLEs.html#numerically-maximizing-a-likelihood"><i class="fa fa-check"></i><b>14.2</b> Numerically Maximizing a likelihood</a></li>
<li class="chapter" data-level="14.3" data-path="MLEs.html"><a href="MLEs.html#the-case-of-a-gaussian"><i class="fa fa-check"></i><b>14.3</b> The case of a Gaussian</a></li>
<li class="chapter" data-level="14.4" data-path="MLEs.html"><a href="MLEs.html#the-case-of-a-linear-model"><i class="fa fa-check"></i><b>14.4</b> The case of a linear model</a></li>
<li class="chapter" data-level="14.5" data-path="MLEs.html"><a href="MLEs.html#the-really-interesting-case"><i class="fa fa-check"></i><b>14.5</b> The really interesting case</a></li>
<li class="chapter" data-level="14.6" data-path="MLEs.html"><a href="MLEs.html#likelihood-above-and-beyond"><i class="fa fa-check"></i><b>14.6</b> Likelihood, above and beyond</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="GLMs.html"><a href="GLMs.html"><i class="fa fa-check"></i><b>15</b> An introduction to generalized linear models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="GLMs.html"><a href="GLMs.html#what-are-glms"><i class="fa fa-check"></i><b>15.1</b> What are GLMs</a></li>
<li class="chapter" data-level="15.2" data-path="GLMs.html"><a href="GLMs.html#the-link-function"><i class="fa fa-check"></i><b>15.2</b> The link function</a></li>
<li class="chapter" data-level="15.3" data-path="GLMs.html"><a href="GLMs.html#most-useful-glm-families"><i class="fa fa-check"></i><b>15.3</b> Most useful GLM Families</a></li>
<li class="chapter" data-level="15.4" data-path="GLMs.html"><a href="GLMs.html#an-example-analysis"><i class="fa fa-check"></i><b>15.4</b> An example analysis</a></li>
<li class="chapter" data-level="15.5" data-path="GLMs.html"><a href="GLMs.html#an-example-of-a-glm-as-a-detail-within-a-conceptualization-framework"><i class="fa fa-check"></i><b>15.5</b> An example of a GLM as a detail within a conceptualization framework</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="aula15.html"><a href="aula15.html"><i class="fa fa-check"></i><b>16</b> Class 15: 17 11 2020</a></li>
<li class="chapter" data-level="17" data-path="example-1---deviance.html"><a href="example-1---deviance.html"><i class="fa fa-check"></i><b>17</b> Example 1 - deviance</a></li>
<li class="chapter" data-level="18" data-path="example-2---lagartyos-glm.html"><a href="example-2---lagartyos-glm.html"><i class="fa fa-check"></i><b>18</b> Example 2 - lagartyos GLM</a>
<ul>
<li class="chapter" data-level="18.1" data-path="example-2---lagartyos-glm.html"><a href="example-2---lagartyos-glm.html#example-2"><i class="fa fa-check"></i><b>18.1</b> Example 2</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="aula16.html"><a href="aula16.html"><i class="fa fa-check"></i><b>19</b> Class 16: 18 11 2020</a>
<ul>
<li class="chapter" data-level="19.1" data-path="aula16.html"><a href="aula16.html#a-logistic-regression-example"><i class="fa fa-check"></i><b>19.1</b> A logistic regression example</a></li>
<li class="chapter" data-level="19.2" data-path="aula16.html"><a href="aula16.html#titanic-example"><i class="fa fa-check"></i><b>19.2</b> Titanic example</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="aula16.html"><a href="aula16.html#análise-exploratoria-de-dados"><i class="fa fa-check"></i><b>19.2.1</b> Análise Exploratoria de Dados</a></li>
<li class="chapter" data-level="19.2.2" data-path="aula16.html"><a href="aula16.html#modelação"><i class="fa fa-check"></i><b>19.2.2</b> Modelação</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="aula16.html"><a href="aula16.html#about-multicollinearity"><i class="fa fa-check"></i><b>19.3</b> About multicollinearity</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="GLMM.html"><a href="GLMM.html"><i class="fa fa-check"></i><b>20</b> Random effects and mixed models</a></li>
<li class="chapter" data-level="21" data-path="aula18.html"><a href="aula18.html"><i class="fa fa-check"></i><b>21</b> Class 18: 25 11 2020</a>
<ul>
<li class="chapter" data-level="21.1" data-path="aula18.html"><a href="aula18.html#presence-of-bats"><i class="fa fa-check"></i><b>21.1</b> Presence of bats</a></li>
<li class="chapter" data-level="21.2" data-path="aula18.html"><a href="aula18.html#sponges"><i class="fa fa-check"></i><b>21.2</b> Sponges</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="aula18.html"><a href="aula18.html#reading-data-in"><i class="fa fa-check"></i><b>21.2.1</b> Reading data in</a></li>
<li class="chapter" data-level="21.2.2" data-path="aula18.html"><a href="aula18.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>21.2.2</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="21.2.3" data-path="aula18.html"><a href="aula18.html#modelling"><i class="fa fa-check"></i><b>21.2.3</b> Modelling</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="aula18.html"><a href="aula18.html#extra-glm-stuff"><i class="fa fa-check"></i><b>21.3</b> Extra GLM stuff</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>22</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Notes for Ecological Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="GLMM" class="section level1 hasAnchor" number="20">
<h1><span class="header-section-number">Chapter 20</span> Random effects and mixed models<a href="GLMM.html#GLMM" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we investigate the use of random effects.</p>
<p>We describe the analysis of the RIKZ dataset, a traditional dataset used to illustrate mixed models, a companion to the book by Zuur et al. ().</p>
<p>We read in the data</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="GLMM.html#cb522-1" tabindex="-1"></a>RIKZ <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;extfiles/RIKZ.txt&quot;</span>)</span>
<span id="cb522-2"><a href="GLMM.html#cb522-2" tabindex="-1"></a><span class="co">#recoding exposure so that 8 and 10 become 0&#39;s and 11&#39;s become 1</span></span>
<span id="cb522-3"><a href="GLMM.html#cb522-3" tabindex="-1"></a>RIKZ<span class="sc">$</span>Exposure<span class="ot">=</span><span class="fu">ifelse</span>(RIKZ<span class="sc">$</span>Exposure<span class="sc">==</span><span class="dv">11</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<p>we look at the data structure</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="GLMM.html#cb523-1" tabindex="-1"></a><span class="fu">str</span>(RIKZ)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    45 obs. of  5 variables:
##  $ Sample  : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Richness: int  11 10 13 11 10 8 9 8 19 17 ...
##  $ Exposure: num  0 0 0 0 0 0 0 0 0 0 ...
##  $ NAP     : num  0.045 -1.036 -1.336 0.616 -0.684 ...
##  $ Beach   : int  1 1 1 1 1 2 2 2 2 2 ...</code></pre>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="GLMM.html#cb525-1" tabindex="-1"></a><span class="fu">head</span>(RIKZ)</span></code></pre></div>
<pre><code>##   Sample Richness Exposure    NAP Beach
## 1      1       11        0  0.045     1
## 2      2       10        0 -1.036     1
## 3      3       13        0 -1.336     1
## 4      4       11        0  0.616     1
## 5      5       10        0 -0.684     1
## 6      6        8        0  1.190     2</code></pre>
<p>We can look at the response variable, species richness, as a function of NA</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="GLMM.html#cb527-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ)</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<p>When we see it like this, there is no notion about the structure of the data, in particular that there are 5 measurements in each beach</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="GLMM.html#cb528-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ)</span>
<span id="cb528-2"><a href="GLMM.html#cb528-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<p>but we could make it a bit more explicit by having different symbols for each beach (say the beach number) and coloring each beach symbol with a diferent color</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="GLMM.html#cb529-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfwor=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning in par(mfwor = c(1, 1)): &quot;mfwor&quot; is not a graphical parameter</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb531-1"><a href="GLMM.html#cb531-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb531-2"><a href="GLMM.html#cb531-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>Now the two stage approach: (1) we consider the relation between R and NAP, for each beach, and (2) we model the estimated coefficients per beach as a function of exposure</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="GLMM.html#cb532-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb532-2"><a href="GLMM.html#cb532-2" tabindex="-1"></a>as<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>);bs<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>);exp<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>)</span>
<span id="cb532-3"><a href="GLMM.html#cb532-3" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb532-4"><a href="GLMM.html#cb532-4" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">lm</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ[RIKZ<span class="sc">$</span>Beach<span class="sc">==</span>i,])</span>
<span id="cb532-5"><a href="GLMM.html#cb532-5" tabindex="-1"></a>  cs<span class="ot">=</span><span class="fu">coef</span>(m)</span>
<span id="cb532-6"><a href="GLMM.html#cb532-6" tabindex="-1"></a>  as[i]<span class="ot">=</span>cs[<span class="dv">1</span>]</span>
<span id="cb532-7"><a href="GLMM.html#cb532-7" tabindex="-1"></a>  bs[i]<span class="ot">=</span>cs[<span class="dv">2</span>]</span>
<span id="cb532-8"><a href="GLMM.html#cb532-8" tabindex="-1"></a>  exp[i]<span class="ot">=</span>RIKZ<span class="sc">$</span>Exposure[i<span class="sc">*</span><span class="dv">5</span>]</span>
<span id="cb532-9"><a href="GLMM.html#cb532-9" tabindex="-1"></a>  <span class="fu">abline</span>(cs,<span class="at">lty=</span>exp[i]<span class="sc">+</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">terrain.colors</span>(<span class="dv">10</span>)[i])</span>
<span id="cb532-10"><a href="GLMM.html#cb532-10" tabindex="-1"></a>}</span>
<span id="cb532-11"><a href="GLMM.html#cb532-11" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Exposure 0&quot;</span>,<span class="st">&quot;Exposure 1&quot;</span>),<span class="at">inset=</span><span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Now the second stage</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb533-1"><a href="GLMM.html#cb533-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb533-2"><a href="GLMM.html#cb533-2" tabindex="-1"></a><span class="fu">boxplot</span>(as<span class="sc">~</span>exp,<span class="at">ylab=</span><span class="st">&quot;intercept&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Exposure&quot;</span>)</span>
<span id="cb533-3"><a href="GLMM.html#cb533-3" tabindex="-1"></a><span class="fu">boxplot</span>(bs<span class="sc">~</span>exp,<span class="at">ylab=</span><span class="st">&quot;slope&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Exposure&quot;</span>)</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<p>The way to do all this in one go is to consider a mixed model, where exposure is a fixed effect, but beach is considered a random effect.</p>
<p>Implementing the mixed model, with just random intercepts</p>
<p>Using <code>lme</code> from <code>nlme</code></p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="GLMM.html#cb534-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb534-2"><a href="GLMM.html#cb534-2" tabindex="-1"></a>RIKZ<span class="sc">$</span>fbeach<span class="ot">=</span><span class="fu">as.factor</span>(RIKZ<span class="sc">$</span>Beach)</span>
<span id="cb534-3"><a href="GLMM.html#cb534-3" tabindex="-1"></a>lme1<span class="ot">=</span><span class="fu">lme</span>(Richness<span class="sc">~</span>NAP,<span class="at">random=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>fbeach,<span class="at">data=</span>RIKZ)</span>
<span id="cb534-4"><a href="GLMM.html#cb534-4" tabindex="-1"></a><span class="fu">summary</span>(lme1)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: RIKZ 
##        AIC     BIC    logLik
##   247.4802 254.525 -119.7401
## 
## Random effects:
##  Formula: ~1 | fbeach
##         (Intercept) Residual
## StdDev:    2.944065  3.05977
## 
## Fixed effects:  Richness ~ NAP 
##                 Value Std.Error DF   t-value p-value
## (Intercept)  6.581893 1.0957618 35  6.006682       0
## NAP         -2.568400 0.4947246 35 -5.191574       0
##  Correlation: 
##     (Intr)
## NAP -0.157
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -1.4227495 -0.4848006 -0.1576462  0.2518966  3.9793918 
## 
## Number of Observations: 45
## Number of Groups: 9</code></pre>
<p>Using <code>lmer</code> from <code>lme4</code></p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="GLMM.html#cb536-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb536-2"><a href="GLMM.html#cb536-2" tabindex="-1"></a>lme2<span class="ot">=</span><span class="fu">lmer</span>(Richness<span class="sc">~</span>NAP<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>fbeach),<span class="at">data=</span>RIKZ)</span>
<span id="cb536-3"><a href="GLMM.html#cb536-3" tabindex="-1"></a><span class="fu">summary</span>(lme2)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Richness ~ NAP + (1 | fbeach)
##    Data: RIKZ
## 
## REML criterion at convergence: 239.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.4227 -0.4848 -0.1576  0.2519  3.9794 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  fbeach   (Intercept) 8.668    2.944   
##  Residual             9.362    3.060   
## Number of obs: 45, groups:  fbeach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   6.5819     1.0958   6.007
## NAP          -2.5684     0.4947  -5.192
## 
## Correlation of Fixed Effects:
##     (Intr)
## NAP -0.157</code></pre>
<p>Make predictions from lme</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="GLMM.html#cb538-1" tabindex="-1"></a>Level0<span class="ot">=</span><span class="fu">fitted</span>(lme1,<span class="at">level=</span><span class="dv">0</span>)</span>
<span id="cb538-2"><a href="GLMM.html#cb538-2" tabindex="-1"></a>Level1<span class="ot">=</span><span class="fu">fitted</span>(lme1,<span class="at">level=</span><span class="dv">1</span>)</span></code></pre></div>
<p>Look at the fitted model predictions over the data (note the use of function <code>ranef</code> to extract the estimated random effects from the fitted model)</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="GLMM.html#cb539-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb539-2"><a href="GLMM.html#cb539-2" tabindex="-1"></a><span class="co">#the pooled line </span></span>
<span id="cb539-3"><a href="GLMM.html#cb539-3" tabindex="-1"></a>intercept<span class="ot">&lt;-</span>lme1<span class="sc">$</span>coefficients<span class="sc">$</span>fixed[<span class="dv">1</span>]</span>
<span id="cb539-4"><a href="GLMM.html#cb539-4" tabindex="-1"></a>slope<span class="ot">&lt;-</span>lme1<span class="sc">$</span>coefficients<span class="sc">$</span>fixed[<span class="dv">2</span>]</span>
<span id="cb539-5"><a href="GLMM.html#cb539-5" tabindex="-1"></a><span class="fu">abline</span>(intercept,slope,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb539-6"><a href="GLMM.html#cb539-6" tabindex="-1"></a><span class="co">#lines(NAPs,Level0[I],lwd=3)</span></span>
<span id="cb539-7"><a href="GLMM.html#cb539-7" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb539-8"><a href="GLMM.html#cb539-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>intercept<span class="sc">+</span><span class="fu">ranef</span>(lme1)[j,<span class="dv">1</span>],<span class="at">b=</span>slope,<span class="at">col=</span><span class="fu">terrain.colors</span>(<span class="dv">10</span>)[j])</span>
<span id="cb539-9"><a href="GLMM.html#cb539-9" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Implementing the mixed model, with random intercepts and slopes</p>
<p>Using <code>lme</code> from <code>nlme</code></p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="GLMM.html#cb540-1" tabindex="-1"></a>lme3<span class="ot">=</span><span class="fu">lme</span>(Richness<span class="sc">~</span>NAP,<span class="at">random=</span><span class="sc">~</span>NAP<span class="sc">|</span>fbeach,<span class="at">data=</span>RIKZ)</span>
<span id="cb540-2"><a href="GLMM.html#cb540-2" tabindex="-1"></a><span class="fu">summary</span>(lme3)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: RIKZ 
##        AIC      BIC    logLik
##   244.3839 254.9511 -116.1919
## 
## Random effects:
##  Formula: ~NAP | fbeach
##  Structure: General positive-definite, Log-Cholesky parametrization
##             StdDev   Corr  
## (Intercept) 3.549051 (Intr)
## NAP         1.714968 -0.99 
## Residual    2.702819       
## 
## Fixed effects:  Richness ~ NAP 
##                 Value Std.Error DF   t-value p-value
## (Intercept)  6.588709 1.2647569 35  5.209467   0e+00
## NAP         -2.830029 0.7229413 35 -3.914605   4e-04
##  Correlation: 
##     (Intr)
## NAP -0.819
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -1.8213363 -0.3411033 -0.1674617  0.1921147  3.0396952 
## 
## Number of Observations: 45
## Number of Groups: 9</code></pre>
<p>Using <code>lmer</code> from <code>lme4</code></p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="GLMM.html#cb542-1" tabindex="-1"></a>lme5<span class="ot">=</span><span class="fu">lmer</span>(Richness<span class="sc">~</span>NAP<span class="sc">+</span>(NAP<span class="sc">|</span>fbeach),<span class="at">data=</span>RIKZ)</span>
<span id="cb542-2"><a href="GLMM.html#cb542-2" tabindex="-1"></a><span class="fu">summary</span>(lme5)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: Richness ~ NAP + (NAP | fbeach)
##    Data: RIKZ
## 
## REML criterion at convergence: 232.4
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.8212 -0.3410 -0.1674  0.1925  3.0397 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  fbeach   (Intercept) 12.600   3.550         
##           NAP          2.942   1.715    -0.99
##  Residual              7.307   2.703         
## Number of obs: 45, groups:  fbeach, 9
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   6.5884     1.2649   5.208
## NAP          -2.8301     0.7231  -3.914
## 
## Correlation of Fixed Effects:
##     (Intr)
## NAP -0.820
## optimizer (nloptwrap) convergence code: 0 (OK)
## Model failed to converge with max|grad| = 0.00267151 (tol = 0.002, component 1)</code></pre>
<p>Make predictions from lme</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="GLMM.html#cb544-1" tabindex="-1"></a>Level0<span class="fl">.3</span><span class="ot">=</span><span class="fu">fitted</span>(lme3,<span class="at">level=</span><span class="dv">0</span>)</span>
<span id="cb544-2"><a href="GLMM.html#cb544-2" tabindex="-1"></a>Level1<span class="fl">.3</span><span class="ot">=</span><span class="fu">fitted</span>(lme3,<span class="at">level=</span><span class="dv">1</span>)</span></code></pre></div>
<p>and ploting the model</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="GLMM.html#cb545-1" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb545-2"><a href="GLMM.html#cb545-2" tabindex="-1"></a><span class="co">#the pooled line </span></span>
<span id="cb545-3"><a href="GLMM.html#cb545-3" tabindex="-1"></a>intercept<span class="ot">&lt;-</span>lme3<span class="sc">$</span>coefficients<span class="sc">$</span>fixed[<span class="dv">1</span>]</span>
<span id="cb545-4"><a href="GLMM.html#cb545-4" tabindex="-1"></a>slope<span class="ot">&lt;-</span>lme3<span class="sc">$</span>coefficients<span class="sc">$</span>fixed[<span class="dv">2</span>]</span>
<span id="cb545-5"><a href="GLMM.html#cb545-5" tabindex="-1"></a><span class="fu">abline</span>(intercept,slope,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb545-6"><a href="GLMM.html#cb545-6" tabindex="-1"></a><span class="co">#lines(NAPs,Level0[I],lwd=3)</span></span>
<span id="cb545-7"><a href="GLMM.html#cb545-7" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb545-8"><a href="GLMM.html#cb545-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>intercept<span class="sc">+</span><span class="fu">ranef</span>(lme3)[j,<span class="dv">1</span>],<span class="at">b=</span>slope<span class="sc">+</span><span class="fu">ranef</span>(lme3)[j,<span class="dv">2</span>],<span class="at">col=</span><span class="fu">terrain.colors</span>(<span class="dv">10</span>)[j])</span>
<span id="cb545-9"><a href="GLMM.html#cb545-9" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>Zuur says in page 110 we could compare the models by AIC, but that is just nonsense. Having been fitted by REML, no AIC is available</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="GLMM.html#cb546-1" tabindex="-1"></a><span class="fu">AIC</span>(lme1)</span></code></pre></div>
<pre><code>## [1] 247.4802</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="GLMM.html#cb548-1" tabindex="-1"></a><span class="fu">AIC</span>(lme3)</span></code></pre></div>
<pre><code>## [1] 244.3839</code></pre>
<p>Just for comparison, we could try to see if a random effect model would be a better model. In other words, was NAP required at all or a different mean by beach would suffice?</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="GLMM.html#cb550-1" tabindex="-1"></a>lme6<span class="ot">=</span><span class="fu">lme</span>(Richness<span class="sc">~</span><span class="dv">1</span>,<span class="at">random=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>fbeach,<span class="at">data=</span>RIKZ)</span></code></pre></div>
<p>We can look at the summary of such a model</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="GLMM.html#cb551-1" tabindex="-1"></a><span class="fu">summary</span>(lme6)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by REML
##   Data: RIKZ 
##        AIC      BIC    logLik
##   267.1142 272.4668 -130.5571
## 
## Random effects:
##  Formula: ~1 | fbeach
##         (Intercept) Residual
## StdDev:    3.237112 3.938415
## 
## Fixed effects:  Richness ~ 1 
##                Value Std.Error DF  t-value p-value
## (Intercept) 5.688889  1.228419 36 4.631066       0
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -1.77968689 -0.50704111 -0.09795286  0.25468670  3.80631705 
## 
## Number of Observations: 45
## Number of Groups: 9</code></pre>
<p>Comparing the 3 models regarding AIC</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="GLMM.html#cb553-1" tabindex="-1"></a><span class="fu">AIC</span>(lme1,lme3,lme6)</span></code></pre></div>
<pre><code>## Warning in AIC.default(lme1, lme3, lme6): models are not all fitted to the same
## number of observations</code></pre>
<pre><code>##      df      AIC
## lme1  4 247.4802
## lme3  6 244.3839
## lme6  3 267.1142</code></pre>
<p>we can see that the most parsimonious model is in fact the one with random intercepts and random slopes.</p>
<p>Just checking the correlation between the parameters in the random intercept and slope model, as they seem higly correlated.</p>
<p>Looking at the coefficients</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="GLMM.html#cb556-1" tabindex="-1"></a><span class="fu">coef</span>(lme3)</span></code></pre></div>
<pre><code>##   (Intercept)       NAP
## 1    8.421059 -3.656259
## 2   12.363492 -5.536807
## 3    3.806646 -1.505714
## 4    3.562425 -1.385958
## 5   11.200160 -5.137363
## 6    4.426283 -1.775668
## 7    4.082949 -1.644330
## 8    5.099897 -2.106848
## 9    6.335472 -2.721318</code></pre>
<p>making a model</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="GLMM.html#cb558-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">coef</span>(lme3)[,<span class="dv">1</span>],<span class="fu">coef</span>(lme3)[,<span class="dv">2</span>],<span class="at">xlab=</span><span class="st">&quot;Intercepts&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Slopes&quot;</span>)</span>
<span id="cb558-2"><a href="GLMM.html#cb558-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(<span class="fu">coef</span>(lme3)[,<span class="dv">2</span>]<span class="sc">~</span><span class="fu">coef</span>(lme3)[,<span class="dv">1</span>]))</span>
<span id="cb558-3"><a href="GLMM.html#cb558-3" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">10</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="fu">paste</span>(<span class="st">&quot;Correlation is&quot;</span>,<span class="fu">round</span>(<span class="fu">cor</span>(<span class="fu">coef</span>(lme3)[,<span class="dv">1</span>],<span class="fu">coef</span>(lme3)[,<span class="dv">2</span>]),<span class="dv">5</span>)))</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>the correlation is in fact very large! Note this correlation is actually an output present in the <code>lme</code> and <code>lmer</code> fitted objects. A very detailed description of what these correlations are when we have more than 1 of them can be found here: <a href="https://rpubs.com/yjunechoe/correlationsLMEM" class="uri">https://rpubs.com/yjunechoe/correlationsLMEM</a>. That is a quite advanced topic though.</p>
<p>Note that we could have considered a standard model where beach might be a factor and we would include an interaction between beach and NAP to allow for both different intercepts and slopes across beaches.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="GLMM.html#cb559-1" tabindex="-1"></a>lmALL<span class="ot">=</span><span class="fu">lm</span>(Richness<span class="sc">~</span>NAP<span class="sc">+</span>fbeach<span class="sc">+</span>NAP<span class="sc">:</span>fbeach,<span class="at">data=</span>RIKZ)</span>
<span id="cb559-2"><a href="GLMM.html#cb559-2" tabindex="-1"></a><span class="fu">summary</span>(lmALL)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Richness ~ NAP + fbeach + NAP:fbeach, data = RIKZ)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.3022 -0.6614 -0.1076  0.4072  5.9090 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  10.8219     1.3341   8.112 1.03e-08 ***
## NAP          -0.3718     1.5493  -0.240 0.812140    
## fbeach2       2.5238     1.7685   1.427 0.165013    
## fbeach3      -7.4212     1.7346  -4.278 0.000211 ***
## fbeach4      -7.7342     1.8541  -4.171 0.000281 ***
## fbeach5       1.9609     1.9485   1.006 0.323166    
## fbeach6      -6.4973     1.7494  -3.714 0.000938 ***
## fbeach7      -7.3013     2.2611  -3.229 0.003253 ** 
## fbeach8      -5.8704     1.7981  -3.265 0.002974 ** 
## fbeach9      -4.5268     1.8631  -2.430 0.022036 *  
## NAP:fbeach2  -3.8034     1.9941  -1.907 0.067169 .  
## NAP:fbeach3  -1.3835     2.0405  -0.678 0.503511    
## NAP:fbeach4  -0.8767     1.9528  -0.449 0.657044    
## NAP:fbeach5  -8.5283     2.1340  -3.996 0.000447 ***
## NAP:fbeach6  -1.0167     1.8290  -0.556 0.582872    
## NAP:fbeach7  -1.1458     2.2756  -0.504 0.618683    
## NAP:fbeach8  -1.5212     1.8134  -0.839 0.408891    
## NAP:fbeach9  -2.5957     1.9537  -1.329 0.195100    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.479 on 27 degrees of freedom
## Multiple R-squared:  0.8494, Adjusted R-squared:  0.7546 
## F-statistic: 8.957 on 17 and 27 DF,  p-value: 4.056e-07</code></pre>
<p>We can represent the models fitted independently beach by beach we had above with this full model with the interaction term side by side:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="GLMM.html#cb561-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb561-2"><a href="GLMM.html#cb561-2" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb561-3"><a href="GLMM.html#cb561-3" tabindex="-1"></a>as<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>);bs<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>);exp<span class="ot">=</span><span class="fu">numeric</span>(<span class="dv">9</span>)</span>
<span id="cb561-4"><a href="GLMM.html#cb561-4" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb561-5"><a href="GLMM.html#cb561-5" tabindex="-1"></a>  m<span class="ot">=</span><span class="fu">lm</span>(Richness<span class="sc">~</span>NAP,<span class="at">data=</span>RIKZ[RIKZ<span class="sc">$</span>Beach<span class="sc">==</span>i,])</span>
<span id="cb561-6"><a href="GLMM.html#cb561-6" tabindex="-1"></a>  cs<span class="ot">=</span><span class="fu">coef</span>(m)</span>
<span id="cb561-7"><a href="GLMM.html#cb561-7" tabindex="-1"></a>  as[i]<span class="ot">=</span>cs[<span class="dv">1</span>]</span>
<span id="cb561-8"><a href="GLMM.html#cb561-8" tabindex="-1"></a>  bs[i]<span class="ot">=</span>cs[<span class="dv">2</span>]</span>
<span id="cb561-9"><a href="GLMM.html#cb561-9" tabindex="-1"></a>  exp[i]<span class="ot">=</span>RIKZ<span class="sc">$</span>Exposure[i<span class="sc">*</span><span class="dv">5</span>]</span>
<span id="cb561-10"><a href="GLMM.html#cb561-10" tabindex="-1"></a>  <span class="fu">abline</span>(cs,<span class="at">lty=</span>exp[i]<span class="sc">+</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">terrain.colors</span>(<span class="dv">10</span>)[i])</span>
<span id="cb561-11"><a href="GLMM.html#cb561-11" tabindex="-1"></a>}</span>
<span id="cb561-12"><a href="GLMM.html#cb561-12" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Exposure 0&quot;</span>,<span class="st">&quot;Exposure 1&quot;</span>),<span class="at">inset=</span><span class="fl">0.05</span>)</span>
<span id="cb561-13"><a href="GLMM.html#cb561-13" tabindex="-1"></a><span class="co">#a single model</span></span>
<span id="cb561-14"><a href="GLMM.html#cb561-14" tabindex="-1"></a><span class="fu">plot</span>(Richness<span class="sc">~</span>NAP,<span class="at">pch=</span><span class="fu">as.character</span>(Beach),<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="fu">as.numeric</span>(Beach)],<span class="at">data=</span>RIKZ)</span>
<span id="cb561-15"><a href="GLMM.html#cb561-15" tabindex="-1"></a><span class="co">#beach 1</span></span>
<span id="cb561-16"><a href="GLMM.html#cb561-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="fu">coef</span>(lmALL)[<span class="dv">1</span>],<span class="at">b=</span><span class="fu">coef</span>(lmALL)[<span class="dv">2</span>],<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[<span class="dv">1</span>],<span class="at">lty=</span>exp[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb561-17"><a href="GLMM.html#cb561-17" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb561-18"><a href="GLMM.html#cb561-18" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">a=</span><span class="fu">coef</span>(lmALL)[<span class="dv">1</span>]<span class="sc">+</span><span class="fu">coef</span>(lmALL)[i<span class="sc">+</span><span class="dv">1</span>],<span class="at">b=</span><span class="fu">coef</span>(lmALL)[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">coef</span>(lmALL)[i<span class="sc">+</span><span class="dv">9</span>],<span class="at">col=</span> <span class="fu">terrain.colors</span>(<span class="dv">10</span>)[i],<span class="at">lty=</span>exp[i]<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb561-19"><a href="GLMM.html#cb561-19" tabindex="-1"></a>  <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Exposure 0&quot;</span>,<span class="st">&quot;Exposure 1&quot;</span>),<span class="at">inset=</span><span class="fl">0.05</span>)</span>
<span id="cb561-20"><a href="GLMM.html#cb561-20" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="ECOMODbook_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>and we can add the AIC of this model to the above comparison</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="GLMM.html#cb562-1" tabindex="-1"></a><span class="fu">AIC</span>(lme1,lme3,lme6,lmALL)</span></code></pre></div>
<pre><code>## Warning in AIC.default(lme1, lme3, lme6, lmALL): models are not all fitted to
## the same number of observations</code></pre>
<pre><code>##       df      AIC
## lme1   4 247.4802
## lme3   6 244.3839
## lme6   3 267.1142
## lmALL 19 224.4232</code></pre>
<p>interestingly, the model without mixed effects is strongly favored as the most parsimonious model. This is perhaps not surprising given the clearly unrealistic model fits given the data for the model with both random intercepts and slopes for beach and NAP within beach. It seems as if the mixed model was not able to truly capture the range of slopes and intercepts required - I suspect this is due to the strong correlation between intercepts ans slopes note above. But then, pragmatically, what would you go about modelling this data?</p>
<p>This is not really the outcome I was looking for here, even if the decision to use beach as random effect or as a fixed effect is a philosophical one.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="aula16.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="aula18.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ECOMODbook.pdf", "ECOMODbook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
